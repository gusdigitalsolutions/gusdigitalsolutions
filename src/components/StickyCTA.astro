---
// StickyCTA.astro - Floating CTA that appears after scrolling past hero
// Uses IntersectionObserver for performance
---

<div
  id="sticky-cta"
  class="fixed z-[999] transition-all duration-700 ease-[cubic-bezier(0.23,1,0.32,1)]
         bottom-6 left-1/2 -translate-x-1/2 md:bottom-10 md:right-12 md:left-auto md:translate-x-0
         opacity-0 pointer-events-none translate-y-10 scale-95"
>
  <a 
    href="https://calendly.com/gus-gusdigitalsolutions/30min" 
    target="_blank" 
    rel="noopener noreferrer"
    class="relative block group"
  >
    <!-- Premium Outer Glow -->
    <div class="absolute -inset-[3px] bg-gradient-to-r from-primary-400 via-cyan-400 to-blue-500 rounded-full opacity-70 group-hover:opacity-100 blur-lg transition-all duration-500"></div>
    
    <!-- Glass Body -->
    <div class="relative flex items-center justify-center px-10 py-4 bg-gradient-to-br from-primary-600 via-primary-600 to-primary-700 backdrop-blur-2xl border border-primary-400/40 rounded-full shadow-2xl group-hover:from-primary-500 group-hover:to-primary-600 transition-all duration-500 overflow-hidden">
      
      <!-- Glossy Overlay -->
      <div class="absolute inset-0 bg-gradient-to-tr from-white/25 via-white/10 to-transparent opacity-60"></div>
      
      <!-- Shimmer Effect -->
      <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/40 to-transparent -translate-x-full group-hover:animate-shimmer"></div>
      
      <!-- Text -->
      <span class="text-white font-black text-base md:text-lg uppercase tracking-wide whitespace-nowrap drop-shadow-[0_2px_6px_rgba(0,0,0,0.4)] relative z-10">Book a Meeting</span>
    </div>
  </a>
</div>

<script>
  const stickyCTA = document.getElementById('sticky-cta');
  const hero = document.getElementById('hero');

  if (hero && stickyCTA) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          updateVisibility();
        });
      },
      { threshold: 0.05 }
    );
    observer.observe(hero);

    const updateVisibility = () => {
      const isHeroVisible = hero.getBoundingClientRect().bottom > 0;
      const isAtBottom = (window.innerHeight + window.scrollY) >= document.body.offsetHeight - 50;

      if (!isHeroVisible && !isAtBottom) {
        stickyCTA.classList.remove('opacity-0', 'translate-y-10', 'pointer-events-none');
        stickyCTA.classList.add('opacity-100', 'translate-y-0', 'pointer-events-auto');
      } else {
        stickyCTA.classList.add('opacity-0', 'translate-y-10', 'pointer-events-none');
        stickyCTA.classList.remove('opacity-100', 'translate-y-0', 'pointer-events-auto');
      }
    };

    window.addEventListener('scroll', updateVisibility, { passive: true });
    window.addEventListener('resize', updateVisibility);
  }
</script>

<style>
  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce) {
    #sticky-cta {
      transition: none;
    }
  }

  .ease-spring {
    transition-timing-function: cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
</style>
